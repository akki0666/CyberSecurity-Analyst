
# Nmap: Network Scanning and Discovery & Wireshark: Network Packet Analysis

## Introduction

**Nmap** (Network Mapper) is an essential tool for network scanning and vulnerability detection. It allows users to discover hosts, open ports, and services on a network, and even identify operating systems. **Wireshark** is a network protocol analyzer that captures and inspects data packets traveling across the network. When used together, these tools provide deep insights into network activity and security.

---

## Scenario 1: Network Scanning Using Nmap

**Objective**: Use Nmap to perform network discovery, identify open ports, and detect services.

#### Steps:

1. **Host Discovery (Ping Sweep)**:
   ```bash
   nmap -sn 192.168.1.0/24
   ```
   - This will scan the subnet `192.168.1.0/24` to identify active devices. The `-sn` option disables port scanning and only performs a ping sweep.

2. **Scanning for Open Ports**:
   ```bash
   nmap -p- 192.168.1.10
   ```
   - Scans all ports on the target `192.168.1.10`. The `-p-` option indicates scanning all 65,535 TCP ports.

3. **Service Version Detection**:
   ```bash
   nmap -sV 192.168.1.10
   ```
   - The `-sV` option allows Nmap to detect services and their versions running on the open ports.

4. **Operating System Detection**:
   ```bash
   nmap -O 192.168.1.10
   ```
   - The `-O` option is used for operating system detection on the target.

5. **Vulnerability Detection**:
   ```bash
   nmap --script vuln 192.168.1.10
   ```
   - This command runs a set of vulnerability detection scripts using Nmap’s Scripting Engine (NSE).

#### Deep Dive into Nmap:
- **Scan Types**: Nmap supports several scan types like TCP connect (`-sT`), SYN scan (`-sS`), and UDP scan (`-sU`). Each is useful for different scenarios depending on network architecture.
- **NSE Scripts**: Use NSE scripts for detecting vulnerabilities, malware, or misconfigurations in services.

#### Outcome:
You will have a detailed map of your network, identifying open ports, services, and potential vulnerabilities.

---

## Scenario 2: Network Packet Capture and Analysis Using Wireshark

**Objective**: Capture and analyze real-time network traffic to troubleshoot and identify issues.

#### Steps:

1. **Capture Traffic**:
   - Open Wireshark, select your network interface (e.g., `eth0`, `wlan0`), and click **Start** to begin capturing packets.

2. **Filter for Specific Traffic**:
   - Filter HTTP traffic using:
     ```bash
     http
     ```
   - Filter TCP packets using:
     ```bash
     tcp
     ```

3. **Analyze DNS Traffic**:
   - Use the following filter to analyze DNS queries and responses:
     ```bash
     dns
     ```
   - Check for DNS-related issues, such as slow or failed lookups.

4. **Inspect Suspicious Traffic**:
   - Filter ICMP traffic (commonly used in ping sweeps or network reconnaissance):
     ```bash
     icmp
     ```
   - Look for unusual ICMP traffic which could indicate scanning or probing.

5. **Save and Export Capture**:
   - After capturing, save the data by navigating to **File > Save As**, and export it in `.pcap` format for later analysis.

#### Deep Dive into Wireshark:
- **Packet Analysis**: Wireshark allows you to drill down into individual packets to view detailed protocol information, such as IP, TCP/UDP headers, and payload.
- **Protocol Filters**: Wireshark’s robust filtering capabilities help isolate specific traffic types and troubleshoot network issues.

#### Outcome:
You will gain insights into your network’s performance, spot anomalies, and troubleshoot connectivity issues.

---

## Scenario 3: Combining Nmap and Wireshark for Advanced Network Analysis

**Objective**: Use Nmap for scanning and Wireshark to analyze the network traffic generated by the scan.

#### Steps:

1. **Run a SYN Scan Using Nmap**:
   ```bash
   nmap -sS 192.168.1.10
   ```
   - Perform a SYN scan on the target `192.168.1.10`. SYN scans send SYN packets to identify open ports without completing the TCP handshake.

2. **Capture Traffic in Wireshark**:
   - Start capturing traffic with Wireshark during the Nmap scan.
   - Filter SYN packets:
     ```bash
     tcp.flags.syn == 1
     ```
   - Observe how the target responds to SYN packets sent by Nmap.

3. **Analyze Results**:
   - Look for SYN-ACK responses, indicating open ports.
   - Analyze if the target sends any RST (Reset) packets for closed ports.

4. **Identify Anomalies**:
   - Use Wireshark to check for unusual network responses, such as unexpected ARP or ICMP traffic.

#### Deep Dive:
- **Nmap Traffic in Wireshark**: Using Wireshark alongside Nmap allows you to visually understand how the target system is responding to scans and detect any odd traffic patterns.
- **Protocol-Specific Filters**: Isolate specific protocols like DNS, HTTP, and FTP to examine the impact of scans on various services.

#### Outcome:
You will have a clear understanding of how network scans interact with devices on the network and any resulting anomalies.

---

## Additional Practical Scenarios

### Scenario 4: Investigating Network Latency Issues

**Objective**: Use Wireshark to analyze network packets and identify latency bottlenecks.

#### Steps:
1. **Capture Traffic During Latency Incident**:
   - Start a Wireshark capture while experiencing slow network performance.

2. **Filter for TCP Retransmissions**:
   ```bash
   tcp.analysis.retransmission
   ```
   - This will show retransmitted TCP packets, often a sign of network congestion or packet loss.

3. **Analyze Round Trip Time (RTT)**:
   - Use Wireshark’s **Statistics > TCP Stream Graphs > Round Trip Time** to measure how long it takes for packets to be acknowledged.

#### Outcome:
You will identify network latency causes, such as retransmissions or delayed responses, and propose fixes (e.g., bandwidth upgrade or network rerouting).

---

### Scenario 5: Detecting a Man-in-the-Middle (MITM) Attack Using Wireshark

**Objective**: Identify signs of a Man-in-the-Middle attack on the network.

#### Steps:
1. **Capture All Network Traffic**:
   - Start capturing network traffic on a potentially compromised segment.

2. **Filter ARP Traffic**:
   ```bash
   arp
   ```
   - Look for duplicate ARP responses, which could indicate ARP spoofing, a common tactic in MITM attacks.

3. **Analyze SSL/TLS Handshakes**:
   - Use the following filter to inspect SSL/TLS traffic:
     ```bash
     ssl
     ```
   - Look for unusual certificates or changes in encryption types, which could indicate that traffic is being intercepted.

#### Outcome:
You detect the MITM attack by identifying ARP spoofing and analyzing unusual SSL traffic, allowing the security team to mitigate the attack.

---

## Conclusion
Nmap and Wireshark are essential tools for network discovery, troubleshooting, and security analysis. Nmap helps in identifying live hosts, open ports, and potential vulnerabilities, while Wireshark allows for deep packet inspection and network troubleshooting. Together, these tools provide a powerful combination for network security professionals and administrators.
